
# GuignoMap - Système de gestion pour la Guignolée 2025 🎄

Une application web moderne conçue spécialement pour optimiser la collecte de dons lors de la Guignolée 2025 à Mascouche.

## ✨ Nouvelles fonctionnalités v4.1

### 👔 Interface Superviseur/Gestionnaire
- **Assignations par secteur** : Sélection secteur + équipe et assignation en bloc
- **Compteur rues non assignées** : Vue en temps réel des rues sans équipe
- **Export CSV assignations** : Colonnes secteur, rue, équipe, statut
- **Gestion d'erreur gracieuse** : Masquage des fonctionnalités indisponibles
- **Notifications toast** : Confirmations visuelles des actions

### 🎅 Interface Bénévole "Mes rues"
- **Vue filtrée par équipe** : Seulement les rues assignées à l'équipe connectée
- **Boutons de statut** : "En cours" et "Terminée" avec mise à jour immédiate
- **Gestion des notes** : Ajout/affichage des notes par adresse spécifique
- **Statistiques d'équipe** : Métriques de progression en temps réel
- **Journal d'activité** : Historique des actions de l'équipe

### 🛡️ Sécurité et robustesse v4.1
- **Validation stricte** : Réutilisation des validators pour toutes les entrées
- **Backup automatique** : Décorateur auto_backup_before_critical sur toutes les écritures
- **Logging complet** : Journal d'activité en base de données ET fichier texte
- **Gestion d'erreur** : Dégradation gracieuse sans plantage de l'application

### 📊 Exports professionnels
- **Maintien des exports PDF/Excel** : Aucune modification des fonctionnalités existantes
- **Nouveau CSV assignations** : Export spécialisé pour la gestion des secteurs
- **Interface unifiée** : Tous les exports accessibles depuis l'onglet Export

## ✨ Fonctionnalités v4.0 (acquises)

### 🔒 Sécurité renforcée
- **Migration bcrypt** : Remplacement SHA256 par bcrypt avec salage automatique
- **Migration automatique** des anciens mots de passe
- **Validation d'entrées** : Protection contre injection SQL et XSS
- **Sanitisation complète** de toutes les données utilisateur

### 💾 Système de backup automatique
- **Backup automatique** avant toutes opérations critiques
- **Format ZIP** avec horodatage
- **Rotation automatique** : conservation 7 jours
- **Interface de gestion** des backups avec téléchargement

## ✨ Fonctionnalités v3.0 (acquises)

### 🎄 Interface festive
- **Page d'accueil moderne** avec compte à rebours vers Noël
- **En-tête festif** aux couleurs de la Guignolée 2025
- **Carte de Noël thématique** avec icônes festives

### 📱 Optimisations mobiles
- **Interface responsive** optimisée pour tous les appareils
- **Navigation tactile** adaptée aux smartphones
- **Contrôles de carte** optimisés pour mobile

### 🏆 Système de motivation
- **Badges d'équipe** : Débutants, Actifs, Champions, Légendes
- **Notifications temps réel** pour les accomplissements
- **Tableaux de bord interactifs** avec graphiques Plotly

### 📊 Centre d'export avancé
- **Export Excel professionnel** avec formatage automatique
- **Génération de listes SMS** pour la communication d'équipe
- **Export PDF** (préparation)
- **Rapports détaillés** par équipe et secteur

### 🗺️ Améliorations cartographiques
- **Choix de fonds de carte** : OpenStreetMap France, CARTO Voyager, Esri
- **Zoom optimisé** centré sur Mascouche
- **Zone d'affichage agrandie** : 90% de l'écran sur PC
- **Gestion d'erreur robuste** : secrets.toml optionnel
- **Visibilité améliorée** des rues avec lignes plus épaisses
- **Récupération complète** de toutes les rues via OSM

### 🗺️ Légende de la carte (persistante)
- **4 états visuels** :
  - 🟢 **Vert** : Rues terminées (collecte finie)
  - 🟡 **Jaune** : Rues en cours (équipe active)
  - 🔴 **Rouge plein** : Rues assignées à faire (équipe désignée)
  - 🔴 **Rouge pointillé** : Rues non assignées (aucune équipe)
- **Position fixe** : Bas-droite de la carte
- **Persistance garantie** : Reste visible au zoom/dézoom/déplacement
- **Style moderne** : Fond blanc, bordure, ombre portée

### ⚙️ Compatibilité et modernisation
- **Python 3.13.6** et versions récentes de Streamlit
- **Suppression de use_container_width** (déprécié) ➜ `width="stretch"`
- **Migration pandas Styler** : `applymap()` ➜ `map()` avec helper de compatibilité
- **Légende persistante** via Folium Elements (remplace l'ancien HTML/CSS)
- **Chemins multi-plateformes** avec pathlib
- **Gestion des erreurs robuste** : l'application ne crash jamais
- **Code moderne** : Nettoyage des anciens hacks et workarounds

### 🎨 Affichage des statuts
- **Codes internes** : `a_faire`, `en_cours`, `terminee` (base de données)
- **Affichage UI/exports** : "À faire", "En cours", "Terminée" (interface utilisateur)
- **Style visual** : Fond pastel + texte contrasté, uniquement sur la colonne "Statut"
- **Couleurs harmonisées** : 
  - 🟢 **Terminée** : Fond vert pâle (#E6F5EA)
  - 🟡 **En cours** : Fond jaune pâle (#FFF3CC)  
  - 🔴 **À faire** : Fond rose pâle (#FFE6EC)

### 🔧 Interface assignations
- **Sélecteur secteur** : Label clair "SECTEUR À ASSIGNER", aucun chevauchement
- **Tableau état** : Colonnes Rue / Secteur / Équipe / Statut avec libellés français
- **Style uniforme** : Rendu standard avec thème sombre (fond neutre, texte blanc)
- **Corrections UI** :
  - Fix superposition texte au-dessus du sélecteur 'SECTEUR À ASSIGNER' (suppression des sorties de debug/injections HTML), tableau des assignations sans stylisation spéciale (rendu uniforme)
  - Layout propre avec container/colonnes, sans overlay ni stylisation
  - Équipes : suppression du doublon de titre causant une superposition dans l'expander
  - Mot de passe équipes : minimum 4 caractères, aucune autre contrainte

### 👥 Gestion moderne
- **Terminologie unifiée** : "gestionnaire" au lieu de "superviseur"
- **Navigation sidebar** moderne et intuitive
- **Interface bénévole restreinte** aux rues assignées seulement
- **Authentification simplifiée** avec cartes de connexion
- **Gestion des équipes améliorée** :
  - Ajout d'un champ Confirmer le mot de passe (création d'équipe)
  - Politique : minimum 4 caractères, aucune autre contrainte
  - Option : case Afficher les mots de passe

## 🚀 Installation et utilisation

### Prérequis
- Python 3.8+
- Accès internet pour OSM et les tuiles de carte

### Installation